workspace:
  base: /app
  path: src/github.com/josebarn/drone-python-tutorial

pipeline:
  build:
    # Start with a small image
    image: josebarn/python-2.7-base:latest
    commands:
      - virtualenv /app/env
      - /app/env/bin/pip install -r requirements.txt
      - /app/env/bin/pip install --upgrade pip setuptools wheel
      - /app/env/bin/pip wheel -r requirements.txt --wheel-dir=wheeldir --find-links=wheeldir
      - /app/env/bin/pip wheel -r test-requirements.txt --wheel-dir=wheeldir --find-links=wheeldir
      - /app/env/bin/pip install --use-wheel --no-index --find-links=wheeldir -r requirements.txt
      - /app/env/bin/pip install --use-wheel --no-index --find-links=wheeldir -r test-requirements.txt
      # package and install
      - /app/env/bin/python setup.py bdist
      - /app/env/bin/python setup.py install
      # All data is retained in the /app/env directory for all remaining steps
